ИНСТРУКЦИЯ ПО РАБОТЕ С «КОНСТРУКТОРОМ ОТЧЁТНЫХ ТАБЛИЦ ОАТИ»

1. НАЗНАЧЕНИЕ И ОБЩИЕ СВЕДЕНИЯ
1.1. Приложение предназначено для формирования сводных отчётов по нарушениям ОАТИ по данным двух Excel-выгрузок: таблицы нарушений и справочника объектов.
1.2. Все вычисления выполняются локально в браузере. Служебные данные не передаются на сервер.
1.3. Интерфейс оптимизирован для последних версий Chromium/Chrome и Firefox. Рекомендуется разрешение экрана от 1280×720.

2. ПОДГОТОВКА ИСХОДНЫХ ФАЙЛОВ
2.1. Допустимые форматы файлов: XLSX и XLS. Каждый файл должен содержать один рабочий лист.
2.2. Первая строка листа обязана содержать заголовки без объединённых ячеек и пустых строк.
2.3. Требуемые столбцы таблицы нарушений:
      • дата обследования;
      • статус нарушения (например, «на устранении», «на контроле инспектора ОАТИ», «снят с контроля»);
      • наименование нарушения;
      • тип/вид объекта контроля;
      • наименование объекта контроля;
      • при наличии — идентификатор объекта, результат обследования, источник данных.
2.4. Требуемые столбцы справочника объектов:
      • внутренний или внешний идентификатор объекта;
      • тип/вид объекта;
      • наименование объекта;
      • административный округ.
2.5. Формат дат допускает стандартные числовые значения Excel, формат «дд.мм.гггг» (с опциональным временем) и ISO `yyyy-mm-dd`.
2.6. Перед загрузкой удалите строки с подписями, примечаниями и объединённые ячейки над заголовком.

3. ЗАПУСК ПРИЛОЖЕНИЯ
3.1. Дважды кликните по файлу `index.html` или поднимите локальный HTTP-сервер: `python -m http.server` в каталоге проекта.
3.2. Откройте страницу в браузере и при необходимости переключите тему оформления кнопкой в правой части шапки.
3.3. Ознакомьтесь с картой процесса и карточкой «Быстрый навигатор» на главном экране.

4. ПОШАГОВЫЙ СЦЕНАРИЙ
4.1. Шаг 1. В секции «Загрузка исходных данных» выберите файл нарушений и файл объектов. Дождитесь исчезновения индикатора «Обработка…».
4.2. Шаг 2. После успешной загрузки откроется раздел «Настройка соответствия столбцов». Проверьте автоматически выбранные поля и при необходимости измените их вручную.
4.3. Шаг 3. В разделе «Параметры отчёта» настройте:
      • даты отчётного периода (обязательны) и предыдущего периода (для расчёта динамики);
      • режим выбора типов объектов — «Все» или «Выбрать вручную» (до трёх значений);
      • режим выбора нарушений — «Все» или «Выбрать вручную» (до пяти значений);
      • фильтр «Источник данных» (по вхождению подстроки, регистр не учитывается);
      • переключатель «Объединять округи НАО и ТАО в ТиНАО».
4.4. Шаг 4. Секция «Предпросмотр отчётной таблицы» отображает агрегированные показатели по округам и итоговую строку. Используйте кнопку «Пересчитать» после каждого изменения фильтров.
4.5. Для выгрузки нажмите «Выгрузить в Excel». Готовый файл содержит лист «Отчёт» с заголовком, нумерацией показателей и форматированием.

5. ЛОГИКА РАСЧЁТА ПОКАЗАТЕЛЕЙ
5.1. «Всего» — количество уникальных объектов из справочника с учётом выбранных фильтров.
5.2. «Проверено объектов контроля…» — объекты, попавшие в выбранный отчётный период.
5.3. «% проверенных объектов…» — отношение показателя 5.2 к показателю 5.1.
5.4. «% объектов с нарушениями» — доля объектов с хотя бы одним нарушением в отчётном периоде.
5.5. «Всего нарушений» — сумма выявленных нарушений текущего периода и нарушений, оставшихся на контроле.
5.6. «Нарушения, выявленные…» — нарушения с датой обследования в пределах отчётного периода.
5.7. «Нарушения на контроле с предыдущей…» — нарушения, начавшиеся ранее и сохранившиеся на контроле.
5.8. «Устранено нарушений» — нарушения со статусом «снят с контроля» в отчётном периоде.
5.9. «Нарушения на контроле» — нарушения со статусами «на устранении», «на контроле инспектора ОАТИ», «новое», «ошибка передачи данных в ЦАФАП».
5.10. Подробные формулы и допущения приведены в файле `FORMULAS.md`.

6. ОСОБЕННОСТИ ФИЛЬТРАЦИИ
6.1. Пользовательские списки типов и нарушений ограничивают расчёт только выбранными значениями. Если список нарушений сужен, перечень доступных типов автоматически фильтруется.
6.2. Фильтр по источнику данных работает без учёта регистра и удаляет лишние пробелы.
6.3. Включение объединения ТиНАО суммирует показатели округов НАО, ТАО и ТиНАО в одну строку отчёта.
6.4. Диапазоны дат анализируются по календарной части без учёта времени.

7. ЭКСПОРТ И СТРУКТУРА ФАЙЛА
7.1. Итоговая книга Excel содержит один лист «Отчёт» со следующими элементами: отступ, заголовок, пустая строка, заголовки столбцов, нумерация показателей, строка «ИТОГО», строки по округам.
7.2. Числовые столбцы форматируются как `#,##0`, проценты — `0.0%`. Ширина столбцов подстраивается автоматически.
7.3. Имя файла формируется по шаблону «Отчёт ОАТИ <дата>.xlsx».

8. РЕШЕНИЕ ПРОБЛЕМ
8.1. Не удаётся определить заголовки — проверьте, что заголовок находится в первой строке и отсутствуют объединения ячеек.
8.2. Пустой предпросмотр — сбросьте фильтры, проверьте диапазоны дат и источник данных.
8.3. Кнопка выгрузки неактивна — дождитесь завершения перерасчёта или нажмите «Пересчитать».
8.4. В Excel отсутствуют значения — проверьте сопоставление столбцов и полноту исходных данных.

9. ОБРАТНАЯ СВЯЗЬ
9.1. Методические вопросы направляйте к кураторам отдела развития информационных систем.
9.2. Технические проблемы фиксируйте в служебном чате или трекере. Обязательно приложите примеры файлов и описание шага, на котором возникла ошибка.

Конец документа.
