<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Конструктор отчетных таблиц ОАТИ</title>
  <link rel="stylesheet" href="style.css" />
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js" defer></script>
  <script src="app.js" type="module" defer></script>
</head>
<body>
  <header class="app-header">
    <h1>Конструктор отчетных таблиц ОАТИ</h1>
    <p>Загрузите исходные файлы с нарушениями и перечнем объектов, настройте параметры и получите интерактивный отчет.</p>
  </header>

  <main class="app-main">
    <section class="card">
      <h2>1. Загрузка исходных данных</h2>
      <div class="file-input-group">
        <label for="violations-file" class="file-label">Таблица по нарушениям (Excel)</label>
        <input type="file" id="violations-file" accept=".xlsx,.xls" />
      </div>
      <div class="file-input-group">
        <label for="objects-file" class="file-label">Таблица по объектам (Excel)</label>
        <input type="file" id="objects-file" accept=".xlsx,.xls" />
      </div>
      <p class="hint">Файлы обрабатываются только в браузере, без отправки на сервер.</p>
    </section>

    <section class="card" id="mapping-section" hidden>
      <h2>2. Настройка соответствия столбцов</h2>
      <div class="mapping-grid">
        <div>
          <h3>Таблица нарушений</h3>
          <div id="violations-mapping" class="mapping-list"></div>
        </div>
        <div>
          <h3>Перечень объектов</h3>
          <div id="objects-mapping" class="mapping-list"></div>
        </div>
      </div>
      <p class="hint">Проверьте, что для каждого требуемого поля выбран корректный столбец. Значения подставляются автоматически, но их можно изменить.</p>
    </section>

    <section class="card" id="controls-section" hidden>
      <h2>3. Параметры отчета</h2>
      <div class="controls-grid">
        <fieldset>
          <legend>Отчетный период</legend>
          <label>
            Начало периода
            <select id="current-start"></select>
          </label>
          <label>
            Конец периода
            <select id="current-end"></select>
          </label>
        </fieldset>
        <fieldset>
          <legend>Предыдущий период</legend>
          <label>
            Начало периода
            <select id="previous-start"></select>
          </label>
          <label>
            Конец периода
            <select id="previous-end"></select>
          </label>
        </fieldset>
        <fieldset>
          <legend>Типы объектов контроля</legend>
          <label class="inline-option">
            <input type="radio" name="type-mode" value="all" checked />
            Все типы объектов
          </label>
          <label class="inline-option">
            <input type="radio" name="type-mode" value="custom" />
            Выбрать до трех типов
          </label>
          <div id="type-options" class="type-options" aria-live="polite"></div>
          <p id="type-message" class="hint" role="status" aria-live="polite"></p>
        </fieldset>
      </div>
      <p class="hint">При выборе пользовательских типов можно отметить не более трех значений.</p>
    </section>

    <section class="card" id="preview-section" hidden>
      <div class="preview-header">
        <h2>4. Предпросмотр отчётной таблицы</h2>
        <div class="preview-actions">
          <button id="refresh-report" type="button">Пересчитать</button>
          <button id="download-report" type="button" disabled>Выгрузить в Excel</button>
        </div>
      </div>
      <p id="preview-message" class="hint"></p>
      <div class="table-wrapper">
        <table id="report-table"></table>
      </div>
    </section>
  </main>

  <footer class="app-footer">
    <p>Формирование отчетов согласно правилам из предоставленных файлов. Все вычисления выполняются локально.</p>
  </footer>
</body>
</html>
